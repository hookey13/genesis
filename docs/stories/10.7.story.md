# Story 10.7: Live Strategy Performance Monitoring

**Status:** Approved
**Epic:** Epic 10 - Core Trading Brain Implementation
**Type:** Sequential-Required (Needs integration points)
**Branch:** feature/10-7
**Estimated Hours:** 8
**Developer Assignment:** Developer 3

## User Story
As a portfolio manager,
I want real-time monitoring of strategy performance with attribution analysis,
So that I can make informed decisions about strategy allocation and risk management.

## Acceptance Criteria
1. Real-time P&L tracking per strategy
2. Performance attribution by strategy component
3. Risk metrics dashboard (VaR, CVaR, Beta)
4. Correlation matrix between strategies
5. Drawdown tracking with recovery time
6. Win rate and profit factor calculation
7. Slippage analysis vs expected fills
8. Strategy capacity estimation
9. Alert system for performance degradation
10. Automated strategy rotation based on performance

## Technical Implementation

### Files to Modify/Create
```
├── genesis/
│   ├── monitoring/
│   │   ├── __init__.py [CREATE]
│   │   ├── strategy_monitor.py [CREATE]
│   │   ├── risk_metrics.py [CREATE]
│   │   └── alert_manager.py [CREATE]
│   └── ui/
│       └── widgets/
│           └── strategy_dashboard.py [CREATE]
└── tests/
    └── unit/
        └── test_strategy_monitor.py [CREATE]
```

### Code Modules Owned
- **Primary:** All monitoring modules
- **No Touch:** Strategy implementations, backtesting

## Dependencies

### Must Complete Before Starting
- Story 10.5 (Trading Engine for integration)
- Story 10.6.2 (Performance metrics)

### Can Start But Needs Later
- None

### Parallel Stories (Same Time)
- Story 10.8 (Paper Trading)

## Implementation Checklist
- [ ] Create feature branch via worktree
- [ ] Create StrategyPerformanceMonitor
- [ ] Implement real-time P&L tracking
- [ ] Add performance attribution
- [ ] Create risk metrics calculators
- [ ] Implement correlation matrix
- [ ] Add drawdown monitoring
- [ ] Create alert system
- [ ] Add strategy rotation logic
- [ ] Create dashboard widget
- [ ] Write unit tests
- [ ] Integration test with engine
- [ ] Create pull request
- [ ] Peer review from Story 10.5 developer
- [ ] Merge to main branch

## Worktree Setup Commands
```bash
# Developer 3 executes:
cd /path/to/main/repo
git worktree add -b feature/10-7 ../worktree-10-7
cd ../worktree-10-7

# After completion:
git push origin feature/10-7
# Create PR for review
```

## Testing Requirements
### Unit Tests
- Test metric calculations
- Test alert triggers
- Test attribution logic
- Test rotation decisions

### Integration Tests
- Live monitoring with mock trades
- Alert system validation

## Definition of Done
- [ ] All acceptance criteria met
- [ ] Code review approved
- [ ] All tests passing
- [ ] Dashboard functional
- [ ] Alerts working
- [ ] Documentation complete
- [ ] Branch merged to main

## Dev Notes

### Testing Standards
- **Test file location:** `tests/unit/test_strategy_monitor.py` and `tests/integration/test_monitoring.py`
- **Test framework:** pytest with async support (pytest-asyncio)
- **Coverage requirement:** >95% for all monitoring modules
- **Test naming:** Use descriptive names like `test_real_time_pnl_tracking_updates_correctly`
- **Mock data:** Use fixtures from `tests/fixtures/market_data.json`
- **Integration tests:** Must validate real-time monitoring with mock trades

### Project Structure
From the source tree, new monitoring modules should be created:
```
genesis/
├── monitoring/                 # NEW DIRECTORY
│   ├── __init__.py
│   ├── strategy_monitor.py    # Main monitoring class
│   ├── risk_metrics.py        # Risk calculations (VaR, CVaR, Beta)
│   └── alert_manager.py       # Alert system for degradation
├── analytics/                  # EXISTING - integrate with
│   ├── metrics.py             # Performance calculations
│   ├── correlation.py        # Correlation monitoring
└── ui/
    └── widgets/
        └── strategy_dashboard.py  # NEW dashboard widget
```

### Architecture Context
- **Python version:** 3.11.8 (no 3.12 features)
- **Async framework:** asyncio (all I/O must be async)
- **Decimal math:** Use decimal.Decimal for all financial calculations
- **Logging:** Use structlog for structured logging (never use print())
- **Database:** SQLite initially, PostgreSQL at $2k+ tier
- **Type hints:** Mandatory for all functions
- **Naming conventions:** Classes use PascalCase, functions use snake_case

### Integration Requirements
- Must integrate with existing `genesis/engine/engine.py` trading loop
- Must use existing `genesis/core/models.py` domain models
- Must respect tier limits from `config/trading_rules.yaml`
- Must integrate with `genesis/analytics/metrics.py` for calculations
- Alert system must use existing notification infrastructure

### Key Implementation Details
- **Real-time P&L:** Calculate using mark-to-market pricing every tick
- **Performance attribution:** Break down P&L by strategy, symbol, and time period
- **Risk metrics:** Calculate VaR at 95% confidence, CVaR for tail risk
- **Correlation matrix:** Use numpy for efficient matrix operations
- **Drawdown tracking:** Track peak-to-trough with recovery time
- **Win rate:** Track as winning_trades / total_trades
- **Profit factor:** Calculate as gross_profit / gross_loss
- **Slippage analysis:** Compare executed price vs signal price
- **Strategy capacity:** Estimate based on market depth and impact
- **Alert thresholds:** Configurable via YAML configuration

### Critical Performance Requirements
- Metric calculation latency: <100ms per strategy
- Dashboard update frequency: Real-time (sub-second)
- Memory usage: <100MB for monitoring components
- Alert delivery: <5 seconds from trigger

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-09-03 | 1.0 | Initial story creation | Sarah (PO) |
| 2025-09-03 | 1.1 | Added Dev Notes and testing requirements | Sarah (PO) |

## Dev Agent Record
*To be populated during implementation*

### Agent Model Used
*TBD*

### Debug Log References
*TBD*

### Completion Notes List
*TBD*

### File List
*TBD*

## QA Results
*To be populated during QA review*